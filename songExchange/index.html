<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ­Œæ›²äº¤æ›</title>

  <!-- Firebase SDK (compat ç‰ˆæœ¬ï¼Œæ”¯æ´èˆŠå¯«æ³•) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      background: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #0056d2;
    }

    #status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 6px;
      font-size: 16px;
      display: none;
    }

    .error { background: #ffdddd; border: 1px solid #ff8888; }
    .success { background: #ddffdd; border: 1px solid #88cc88; }
  </style>
</head>

<body>

  <h2>ğŸµ å¡«ä¸€é¦–ä½ æ¨è–¦çš„æ­Œ</h2>

  <label>æ­Œåï¼š</label>
  <input id="songNameInput" type="text" placeholder="è¼¸å…¥æ­Œå">

  <label>æ­Œæ‰‹ï¼š</label>
  <input id="artistInput" type="text" placeholder="è¼¸å…¥æ­Œæ‰‹">

  <button onclick="submitSong()">æäº¤</button>

  <div id="status"></div>

  <script>
    /* ---------------------------
       Firebase è¨­å®š
    ---------------------------- */
    const firebaseConfig = {
      apiKey: "AIzaSyDl7MRgN9kYxJKPgb_3Q8C4HcznFsO-rdI",
      authDomain: "shuffle-song-suggestions.appspot.com",
      projectId: "shuffle-song-suggestions",
      storageBucket: "shuffle-song-suggestions.firebasestorage.app",
      messagingSenderId: "92017531680",
      appId: "1:92017531680:web:358a69edcb70cb4b7c1545"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /* ---------------------------
       ä¸»åŠŸèƒ½ï¼šæäº¤æ­Œå
    ---------------------------- */
    async function submitSong() {
      const songName = document.getElementById("songNameInput").value.trim();
      const artist = document.getElementById("artistInput").value.trim();
      const statusBox = document.getElementById("status");

      if (!songName || !artist) {
        showStatus("è«‹å¡«å¯«å®Œæ•´çš„æ­Œåèˆ‡æ­Œæ‰‹ï¼", "error");
        return;
      }

      // æª¢æŸ¥æ˜¯å¦é‡è¤‡
      const q = await db.collection("SongList")
                        .where("name", "==", songName)
                        .where("artist", "==", artist)
                        .get();

      if (!q.empty) {
        showStatus("âŒ é€™é¦–æ­Œå·²ç¶“åœ¨æ­Œå–®ä¸­ï¼Œè«‹æ›ä¸€é¦–ï¼", "error");
        return;
      }

      // è®€å–æ•´å€‹æ­Œå–® â†’ æŠ½æ­Œ
      const allSongsSnapshot = await db.collection("SongList").get();
      const songs = allSongsSnapshot.docs.map(d => d.data());

      const randomSong = songs[Math.floor(Math.random() * songs.length)];

      // é¡¯ç¤ºæ¨è–¦æ­Œæ›²
      showStatus(
        "ğŸ‰ ä½ æŠ½åˆ°çš„æ¨è–¦æ­Œæ›²æ˜¯ï¼š<br><b>"
        + randomSong.name + " - " + randomSong.artist
        + "</b><br><br>ä½ çš„æ¨è–¦å·²åŠ å…¥æ­Œå–®ï¼",
        "success"
      );

      // å¯«å…¥æ–°çš„æ­Œæ›²
      await db.collection("SongList").add({
        name: songName,
        artist: artist
      });

      // æ¸…ç©ºè¼¸å…¥æ¬„
      document.getElementById("songNameInput").value = "";
      document.getElementById("artistInput").value = "";
    }

    /* ---------------------------
       é¡¯ç¤ºè¨Šæ¯
    ---------------------------- */
    function showStatus(msg, type) {
      const box = document.getElementById("status");
      box.style.display = "block";
      box.className = type;
      box.innerHTML = msg;
    }
  </script>

</body>
</html>
