<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ­Œæ›²äº¤æ›</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      max-width: 480px;
      background: white;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 48px 40px;
      margin: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #2d3748;
      margin: 0 0 8px 0;
      line-height: 1.3;
    }

    .emoji {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .form-group {
      margin-bottom: 24px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 8px;
    }

    input {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    input::placeholder {
      color: #a0aec0;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      font-size: 18px;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 8px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    #status {
      margin-top: 24px;
      padding: 16px;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.6;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .error {
      background: #fed7d7;
      border: 2px solid #fc8181;
      color: #742a2a;
    }

    .success {
      background: #c6f6d5;
      border: 2px solid #68d391;
      color: #22543d;
    }

    .success b {
      color: #2f855a;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header"><span class="emoji">ğŸµ</span>
    <h1 id="pageTitle">å¡«ä¸€é¦–ä½ æ¨è–¦çš„æ­Œèˆ‡æ­Œåº«äº¤æ›</h1>
   </div>
   <div class="form-group"><label for="songNameInput" id="songLabel">æ­Œåï¿½ï¿½ï¿½</label> <input id="songNameInput" type="text" placeholder="è¼¸å…¥æ­Œå">
   </div>
   <div class="form-group"><label for="artistInput" id="artistLabel">æ­Œæ‰‹ï¼š</label> <input id="artistInput" type="text" placeholder="è¼¸å…¥æ­Œæ‰‹">
   </div>
   <div class="form-group"><label for="youtubeInput" id="youtubeLabel">YouTubeç¶²å€ï¼ˆé¸å¡«ï¼‰ï¼š</label> <input id="youtubeInput" type="url" placeholder="https://www.youtube.com/watch?v=...">
   </div><button class="submit-btn" id="submitBtn" onclick="submitSong()">æäº¤</button>
   <div id="status"></div>
  </div>
  <script>
  const defaultConfig = {
    page_title: "å¡«ä¸€é¦–ä½ æ¨è–¦çš„æ­Œèˆ‡æ­Œåº«äº¤æ›ğŸµ",
    song_label: "æ­Œåï¼š",
    artist_label: "æ­Œæ‰‹ï¼š",
    youtube_label: "YouTubeç¶²å€ï¼ˆé¸å¡«ï¼‰ï¼š",
    button_text: "æäº¤",
    background_color: "#667eea",
    surface_color: "#ffffff",
    text_color: "#2d3748",
    primary_action_color: "#667eea",
    secondary_action_color: "#764ba2"
  };

  async function onConfigChange(config) {
    const pageTitle = config.page_title || defaultConfig.page_title;
    const songLabel = config.song_label || defaultConfig.song_label;
    const artistLabel = config.artist_label || defaultConfig.artist_label;
    const youtubeLabel = config.youtube_label || defaultConfig.youtube_label;
    const buttonText = config.button_text || defaultConfig.button_text;
    const backgroundColor = config.background_color || defaultConfig.background_color;
    const surfaceColor = config.surface_color || defaultConfig.surface_color;
    const textColor = config.text_color || defaultConfig.text_color;
    const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
    const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;

    document.getElementById('pageTitle').textContent = pageTitle;
    document.getElementById('songLabel').textContent = songLabel;
    document.getElementById('artistLabel').textContent = artistLabel;
    document.getElementById('youtubeLabel').textContent = youtubeLabel;
    document.getElementById('submitBtn').textContent = buttonText;

    document.body.style.background = `linear-gradient(135deg, ${primaryActionColor} 0%, ${secondaryActionColor} 100%)`;
    document.querySelector('.container').style.background = surfaceColor;
    document.querySelector('.header h1').style.color = textColor;
    document.querySelectorAll('label').forEach(label => {
      label.style.color = textColor;
    });
    document.querySelector('.submit-btn').style.background = `linear-gradient(135deg, ${primaryActionColor} 0%, ${secondaryActionColor} 100%)`;
  }

  if (window.elementSdk) {
    window.elementSdk.init({
      defaultConfig,
      onConfigChange,
      mapToCapabilities: (config) => ({
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              config.secondary_action_color = value;
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      }),
      mapToEditPanelValues: (config) => new Map([
        ["page_title", config.page_title || defaultConfig.page_title],
        ["song_label", config.song_label || defaultConfig.song_label],
        ["artist_label", config.artist_label || defaultConfig.artist_label],
        ["youtube_label", config.youtube_label || defaultConfig.youtube_label],
        ["button_text", config.button_text || defaultConfig.button_text]
      ])
    });
  }

  const firebaseConfig = {
    apiKey: "AIzaSyDl7MRgN9kYxJKPgb_3Q8C4HcznFsO-rdI",
    authDomain: "shuffle-song-suggestions.firebaseapp.com",
    projectId: "shuffle-song-suggestions",
    storageBucket: "shuffle-song-suggestions.appspot.com",
    messagingSenderId: "92017531680",
    appId: "1:92017531680:web:358a69edcb70cb4b7c1545"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function submitSong() {
    const songName = document.getElementById("songNameInput").value.trim();
    const artist = document.getElementById("artistInput").value.trim();
    const youtubeUrl = document.getElementById("youtubeInput").value.trim();

    if (!songName || !artist) {
      showStatus("è«‹å¡«å¯«å®Œæ•´çš„æ­Œåèˆ‡æ­Œæ‰‹ï¼", "error");
      return;
    }

    const songListRef = db.collection("SongList");

    try {
      const duplicateSnapshot = await songListRef
        .where("songname", "==", songName)
        .where("artist", "==", artist)
        .get();

      if (!duplicateSnapshot.empty) {
        showStatus("âŒ é€™é¦–æ­Œå·²ç¶“åœ¨æ­Œå–®ä¸­ï¼Œè«‹æ›ä¸€é¦–ï¼", "error");
        return;
      }

      const allSongsSnapshot = await songListRef.get();
      let maxId = 0;
      const songs = [];
      allSongsSnapshot.forEach(doc => {
        const data = doc.data();
        songs.push(data);
        if (data.songId && data.songId > maxId) maxId = data.songId;
      });
      const newIdNumber = maxId + 1;
      const docId = String(newIdNumber).padStart(3, "0");

      await songListRef.doc(docId).set({
        songId: newIdNumber,
        songname: songName,
        artist: artist,
        YT: youtubeUrl || ""
      });

      let randomSong = null;
      if (songs.length > 0) {
        randomSong = songs[Math.floor(Math.random() * songs.length)];
      }

      if (randomSong) {
        let message = `ğŸ‰ è¬è¬ï¼ä½ çš„æ¨è–¦å·²åŠ å…¥æ­Œå–®ï¼<br>ä½ æŠ½åˆ°çš„æ¨è–¦æ­Œæ›²æ˜¯ï¼š<b>${randomSong.songname} - ${randomSong.artist}</b>`;
        
        if (randomSong.YT && randomSong.YT !== "") {
          message += `<br><a href="${randomSong.YT}" target="_blank" rel="noopener noreferrer" style="color: #4299e1; text-decoration: underline; font-weight: 600;">ğŸ¬ é»æ­¤è§€çœ‹ YouTube</a>`;
        }
        
        showStatus(message, "success");
      } else {
        showStatus(
          `ğŸ‰ è¬è¬ï¼ä½ çš„æ¨è–¦å·²åŠ å…¥æ­Œå–®ï¼<br>ç›®å‰æ­Œå–®é‚„æ²’æœ‰å…¶ä»–æ­Œæ›²å¯ä»¥æŠ½ï¼`,
          "success"
        );
      }

      document.getElementById("songNameInput").value = "";
      document.getElementById("artistInput").value = "";
      document.getElementById("youtubeInput").value = "";

    } catch (err) {
      console.error(err);
      showStatus("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message, "error");
    }
  }

  function showStatus(msg, type) {
    const box = document.getElementById("status");
    box.style.display = "block";
    box.className = type;
    box.innerHTML = msg;
  }

  onConfigChange(window.elementSdk ? window.elementSdk.config : defaultConfig);
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a90c875a405a9c2',t:'MTc2NDkwODc2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
